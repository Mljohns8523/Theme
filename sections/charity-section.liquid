{% schema %}
{
  "name": "Charity Donation",
  "settings": [
    {
      "type": "image_picker",
      "id": "charity_logo",
      "label": "Charity Logo"
    },
    {
      "type": "text",
      "id": "charity_name",
      "label": "Charity Name",
      "default": "Your Chosen Charity"
    },
    {
      "type": "number",
      "id": "donation_percentage",
      "label": "Donation Percentage",
      "default": 10,
      "info": "Enter the percentage of sales to donate (1-100)"
    },
    {
      "type": "textarea",
      "id": "charity_description",
      "label": "Charity Description",
      "default": "We proudly support our chosen charity by donating a portion of every sale."
    },
    {
      "type": "header",
      "content": "Color Settings"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#F9FAFB"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#1F2937"
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Heading Color",
      "default": "#111827"
    },
    {
      "type": "color",
      "id": "underline_color",
      "label": "Underline Color",
      "default": "#EF4444"
    },
    {
      "type": "color",
      "id": "progress_bar_color",
      "label": "Progress Bar Color",
      "default": "#10B981"
    },
    {
      "type": "header",
      "content": "Typography Settings"
    },
    {
      "type": "range",
      "id": "desktop_heading_size",
      "min": 20,
      "max": 48,
      "step": 2,
      "unit": "px",
      "label": "Desktop Heading Font Size",
      "default": 32
    },
    {
      "type": "range",
      "id": "mobile_heading_size",
      "min": 16,
      "max": 36,
      "step": 2,
      "unit": "px",
      "label": "Mobile Heading Font Size",
      "default": 24
    },
    {
      "type": "range",
      "id": "desktop_text_size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "label": "Desktop Text Font Size",
      "default": 16
    },
    {
      "type": "range",
      "id": "mobile_text_size",
      "min": 10,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Mobile Text Font Size",
      "default": 14
    },
    {
      "type": "header",
      "content": "Progress Bar Settings"
    },
    {
      "type": "number",
      "id": "goal_amount",
      "label": "Goal Amount ($)",
      "default": 5000,
      "info": "Enter the total donation goal in dollars"
    },
    {
      "type": "number",
      "id": "current_raised",
      "label": "Current Amount Raised ($)",
      "default": 0,
      "info": "Enter the current amount raised in dollars"
    }
  ],
  "presets": [
    {
      "name": "Charity Donation"
    }
  ]
}
{% endschema %}

<div class="charity-section py-12 px-4 sm:px-6 lg:px-8 text-center">
  <div
    class="max-w-4xl mx-auto charity-container"
    style="background-color: {{ section.settings.background_color | default: '#F9FAFB' }}; color: {{ section.settings.text_color | default: '#1F2937' }};"
  >
    {% if section.settings.charity_logo != blank %}
      <img
        src="{{ section.settings.charity_logo | img_url: '300x' }}"
        alt="{{ section.settings.charity_name | escape }}"
        class="mx-auto mb-6 max-w-[200px] transition-transform duration-300 hover:scale-105"
      >
    {% endif %}

    {% if section.settings.charity_name != blank %}
      <h2
        class="charity-heading font-bold mb-4"
        style="color: {{ section.settings.heading_color | default: '#111827' }}; font-size: {{ section.settings.desktop_heading_size | default: 32 }}px;"
      >
        {{ section.settings.charity_name }}
      </h2>
    {% endif %}

    {% if section.settings.donation_percentage > 0 %}
      <p
        class="charity-text font-medium mb-6"
        style="font-size: {{ section.settings.desktop_text_size | default: 16 }}px;"
      >
        <span class="donation-highlight">{{ section.settings.donation_percentage }}%</span> of every sale is donated to
        {{ section.settings.charity_name }}.
      </p>
    {% endif %}

    {% if section.settings.charity_description != blank %}
      <p class="charity-text mb-8" style="font-size: {{ section.settings.desktop_text_size | default: 16 }}px;">
        {{ section.settings.charity_description }}
      </p>
    {% endif %}

    <div class="progress-bar-container mb-8">
      <p class="charity-text mb-2" style="font-size: {{ section.settings.desktop_text_size | default: 16 }}px;">
        Raised: ${{ section.settings.current_raised | default: 0 }} / $
        {{- section.settings.goal_amount | default: 5000 }}
      </p>
      <div class="progress-bar-outer">
        {% assign goal = section.settings.goal_amount | default: 5000 | at_least: 1 %}
        {% assign raised = section.settings.current_raised | default: 0 %}
        {% assign percentage = raised | times: 100 | divided_by: goal | at_most: 100 %}
        <div
          class="progress-bar-inner"
          style="width: {{ percentage }}%; background-color: {{ section.settings.progress_bar_color | default: '#10B981' }};"
        ></div>
      </div>
    </div>

    <div
      class="charity-underline"
      style="border-bottom: 4px solid {{ section.settings.underline_color | default: '#EF4444' }}; width: 50%; margin: 0 auto; margin-top: 20px;"
    ></div>
  </div>
</div>

<style>
  /* Debug: Check if this style block loads */
  .charity-section {
    animation: fadeIn 0.6s ease-in-out;
  }

  .charity-container {
    padding: 2rem;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    margin: 0 auto;
  }

  .charity-heading {
    line-height: 1.2;
  }

  .charity-text {
    line-height: 1.5;
  }

  .donation-highlight {
    font-weight: bold;
    text-decoration: underline;
  }

  .progress-bar-outer {
    width: 100%;
    height: 20px;
    background-color: #E5E7EB;
    border-radius: 10px;
    overflow: hidden;
  }

  .progress-bar-inner {
    height: 100%;
    transition: width 2s ease-in-out;
    border-radius: 10px;
    animation: progressGlow 2s infinite alternate;
  }

  @media (max-width: 640px) {
    .charity-heading {
      font-size: {{ section.settings.mobile_heading_size | default: 24 }}px;
    }

    .charity-text {
      font-size: {{ section.settings.mobile_text_size | default: 14 }}px;
    }
  }

  /* Fade-in animation for the section */
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* Glowing animation for the progress bar */
  @keyframes progressGlow {
    0% { box-shadow: 0 0 5px {{ section.settings.progress_bar_color | default: '#10B981' }}; }
    100% { box-shadow: 0 0 15px {{ section.settings.progress_bar_color | default: '#10B981' }}; }
  }
</style>
